#!/usr/bin/env ruby
require 'yajl'
require 'yaml'

index = {}
Yajl::Parser.parse(`zsh -c "exiftool -j -fast2 -Keywords public/images/**/"`).each do |t|
  img = t["SourceFile"].sub(/public/,'')
  if img =~ /jpg|jpeg/i
    if t["Keywords"]
      index[img] = t["Keywords"]
    else
      index[img] = []
    end
  end
end
File.open('index.yaml', 'w+') { |f| f.puts index.to_yaml }
